#include "types.h"
#include "io.h"
#include "mmu.h"
#include "dev/ide.h"
#include "fs/fat.h"
#include "fs/fs.h"

static int
count(char** argv)
{
    char** s;
    uint i;
    // the last value is 0
    for (s=argv;*s != 0;s++,i++);
    return i;
}

extern struct fdir  root;

// dump write
char* buf = "11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
11223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344556611223344556677889900112233445566\
aabbccdd##667788990011223344556611223344556677889900112233445566112233445566778899001122334455661122334455667788990011223344}}||";

int
exec(uint eip,char* path,char** argv)
{
    sti();
    sleep(1);
    
    fdir_init(&root);
    fat_init(&root,1,"root");
    fat_create(&root,"a.txt",4096,FT_FILE);
    fat_init_fdir(&root);
    vprintf("%d \n",strlen(buf));
    fat_write(&root,"a.txt",buf,strlen(buf));
    // fnode_dump(&root.cur[2]);
    // fnode_dump(&root.cur[3]);
    fat_clean(1);

    for(;;)
        ;

    return -1;
}
